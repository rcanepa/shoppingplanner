{% extends "base.html" %}

{% block topbar %}

{% include "planes/menu_plan_trabajo_detail.html" %}

{% endblock topbar %}

{% block username %}
	{{ full_name }}
{% endblock %}

{% block sidebar %}
<div class="pure-menu pure-menu-open">
    <a class="pure-menu-heading">Acciones</a>
    <ul id="ul-menu-acciones">
        <li><a href="{% url 'planes:plan_detail' plan.id %}">Volver</a></li>
        <li><a href="" id="btnPB">Precio Blanco</a></li>
        <li><a href="" id="btnCU">Costo Unitario</a></li>
        <li class="pure-menu-disabled" id="panel-acciones"><a href="" id="btnSave">Guardar</a></li>
    </ul>
</div>

<!-- Seccion con parametros de busqueda del item a proyectar  -->
<div class="caja_bordes" style="padding: 0px 0px; float:left; width:100%;">
    <a class="caja-header">Proyecci&oacute;n</a>
    <table style="width:100%;">
        {% for categoria in combo_categorias %}
        <tr>
            <td><label>{{ categoria.nombre }}</label></td>
        </tr>
        <tr>
            <td>
                <select id="combo_cat_proy_{{ categoria.id }}" class="buscador">
                    <option value="-1" selected></option>
                    {% for item in items_categoria_raiz %}
                        {% if item.categoria = categoria %}
                        <option value="{{ item.id }}">{{ item.nombre }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </td>
        </tr>
        {% endfor %}
        <tr>
            <td><label>ITEMS</label></td>
        </tr>
        <tr>
            <td>
                <select id="combo_resultado" class="buscador">
                </select>
            </td>
        </tr>
    </table>
    <a class="caja-header">Comparativo</a>
    <table style="width:100%;">
        {% for categoria in combo_categorias_comp %}
        <tr>
            <td style="width:80%">
                <label>{{ categoria.nombre }}</label>
            </td>
            <td style="width:20%"></td>
        </tr>
        <tr>
            <td style="width:80%">
                <select id="combo_cat_comp_{{ categoria.id }}" class="buscador">
                    <option value="-1" selected></option>
                    {% for item in items_categoria_raiz %}
                        {% if item.categoria = categoria %}
                        <option value="{{ item.id }}">{{ item.nombre }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </td>
            <td style="width:20%">
                <button type="button" id="button_cat_comp_{{ categoria.id }}" class="pure-button pure-button-active" style="font-size: 70%;background: rgb(66, 184, 221);">></button>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- Seccion con parametros de busqueda del item a proyectar  -->
{% endblock %}

{% block content %}
{% if msg %}
<h3>Proyectar Información</h3>
<div class="msg_warning">
    {{ msg }}
</div>
{% else %}

<div id="accordion">
    <h3>Item</h3>
    <div>
    <!-- div para la vista de proyeccion -->
        <div id="tab_item_proyeccion">
            <div style="width:100%; float:left">
                <div id="tab_proyeccion" style="float:left; width:100%;" class="tabla_datos_actividad">
                </div>
            </div>
        </div>

    <!-- div para la vista de planificacion de temporada vigente -->
        <div id="tab_item_planificacion_tv" style="display:none;">
            <div style="width:100%; float:left">
                <div style="width:100%; float:left;">
                    <div id="tab_planificacion_etiquetas" style="width:10%; float:left;" class="tabla_datos_actividad">
                    </div>
                    <div id="tab_planificacion_datos" style="width:90%; float:left;" class="tabla_datos_actividad">
                    </div>
                </div>
            </div>
        </div>

    <!-- div para la vista de planificacion de avances y saldos -->
        <div id="tab_item_planificacion_as" style="display:none;">
            <div style="width:100%; float:left">
                <div id="tab_planificacion_as" style="float:left; width:100%;" class="tabla_datos_actividad">
                </div>
            </div>
        </div>

    <!-- div para la vista de resumen -->
        <div id="tab_item_resumen" class="pure-g" style="display:none;">
            <div class="pure-u-1-2">
                <div class="titulo_chart"><h3>Venta</h3></div>
                <div><canvas id="venta-chart" width="500" height="230">[No canvas support]</canvas></div>
            </div>

            <div class="pure-u-1-2">
                <div class="titulo_chart"><h3>Contribuci&oacute;n y Margen</h3></div>
                <div><canvas id="contribucion-chart" width="500" height="230">[No canvas support]</canvas></div>
            </div>

            <div class="pure-u-1-2">
                <div class="titulo_chart"><h3>Unidades</h3></div>
                <div><canvas id="unidades-chart" width="500" height="230">[No canvas support]</canvas></div>
            </div>

            <div class="pure-u-1-2">
                <div class="titulo_chart"><h3>Precio Blanco</h3></div>
                <div><canvas id="precio-chart" width="500" height="230">[No canvas support]</canvas></div>
            </div>
        </div>

    </div>
    <h3>Comparativo</h3>
    <div>
    <!-- div para la vista de proyeccion comparativa -->
        <div id="tab_item_proyeccion_comp">
            <div id="item_proyeccion_comp"></div>
            <div style="width:100%; float:left">
                <div id="tab_comparativo" style="float:left; width:100%;" class="tabla_datos_actividad_comp">
                </div>
            </div>
        </div>

    <!-- div para la vista de planificacion de temporada vigente comparativa -->
        <div id="tab_item_planificacion_tv_comp" style="display:none;">
            <div id="item_planificacion_tv_comp"></div>
            <div style="width:100%; float:left;">
                <div id="tab_comparativo_etiquetas" style="width:10%; float:left;" class="tabla_datos_actividad_comp">
                </div>
                <div id="tab_comparativo_datos" style="width:90%; float:left;" class="tabla_datos_actividad_comp">
                </div>
            </div>
        </div>

    <!-- div para la vista de planificacion de avances y saldos comparativa -->
        <div id="tab_item_planificacion_as_comp">
            <div id="item_planificacion_as_comp"></div>
            <div style="width:100%; float:left">
                <div id="tab_planificacion_as_comp" style="float:left; width:100%;" class="tabla_datos_actividad_comp">
                </div>
            </div>
        </div> 

    <!-- div para la vista de resumen -->
        <div id="tab_item_resumen_comp" class="pure-g" style="display:none;">
            <div class="pure-u-1-2">
                <div class="titulo_chart"><h3>Venta</h3></div>
                <div><canvas id="venta-chart-comp" width="500" height="230">[No canvas support]</canvas></div>
            </div>

            <div class="pure-u-1-2">
                <div class="titulo_chart"><h3>Contribuci&oacute;n y Margen</h3></div>
                <div><canvas id="contribucion-chart-comp" width="500" height="230">[No canvas support]</canvas></div>
            </div>

            <div class="pure-u-1-2">
                <div class="titulo_chart"><h3>Unidades</h3></div>
                <div><canvas id="unidades-chart-comp" width="500" height="230">[No canvas support]</canvas></div>
            </div>

            <div class="pure-u-1-2">
                <div class="titulo_chart"><h3>Precio Blanco</h3></div>
                <div><canvas id="precio-chart-comp" width="500" height="230">[No canvas support]</canvas></div>
            </div>
        </div>

    </div>
</div>
<div id="dvLoading" style="display:none;"></div>
<div style="display:none;">
    <form id="form_datos">
        {% csrf_token %}
        <input id="json_datos_tarea" type="hidden" name="datos_tarea" value="" />
    </form>
</div>
<div style="display:none;">
    <form id="form_datos_pbcu">
        {% csrf_token %}
        <input id="json_ajuste_pbcu" type="hidden" name="datos_ajuste_pbcu" value="" />
    </form>
</div>
<div id="dialog-box" title="Ajustar Información" style="text-align:center;">
    <p id="dialog_help_msg"></p>
    <input id="inputval" type="text" style="width:8em">
</div>

<div id="dialog-box-pbcu" title="Ajustar Información" style="text-align:center;">
    <p id="dialog_pbcu_help_msg"></p>
    <input id="input_pbcu" type="text" style="width:8em">
</div>

{% endif%}

{% endblock %}

{% block js %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static "planes/css/trabajo.css" %}">
<script>

$(function() {

    /*
    Objeto que mantiene informacion y principales estados del trabajo que el usuario
    se encuentra realizando en la pagina.
    */
    obj_trabajo = function(){
        /* ID del item sobre el cual esta trabajando */
        var id_item = -1;
        /* ID del item sobre el cual esta comparando */
        var id_item_comp = -1;
        var precio_item = 0;
        var costo_item = 0;
        /*
        Almacena la tarea que se esta realizando sobre la planificacion:
            - 1 Proyeccion (valor por defecto)
            - 2 Planificacion Temporada Vigente
            - 3 Planificacion Saldos y Avances
            - 4 Resumen
        */
        var actividad = 1;
        // ID de la planificacion sobre la cual se esta trabajando
        var id_plan = parseInt({{plan.id}});
        /*
        Almacena el estado del trabajo, es decir, si se han realizado modificaciones que deben ser guardadas:
            - false = no han habido modificaciones
            - true = ha sido modificada y los cambios no han sido guardados
        */
        var modificada = false;

        var datos = null;
        var datos_comp = null;

        var celda_editada = null;
        
        function setItem(id){id_item = id;}
        function getItem(){return id_item;}

        function setItemComp(id){id_item_comp = id;}
        function getItemComp(){return id_item_comp;}

        function setPrecioItem(precio){precio_item = precio;}
        function getPrecioItem(){return precio_item;}

        function setCostoItem(costo){costo_item = costo;}
        function getCostoItem(){return costo_item;}
        
        function getPlan(){return id_plan;}

        function setModificada(estado){modificada = estado;}
        function getModificada(){return modificada;}

        function setActividad(codigo){actividad = codigo;}
        function getActividad(){return actividad;}

        function getDatos(){return datos;}
        function setDatos(x){datos = x;}

        function getDatosComp(){return datos_comp;}
        function setDatosComp(x){datos_comp = x;}

        function getCeldaEditada(){return celda_editada;}
        function setCeldaEditada(elemento){celda_editada = elemento;}

        function limpiarItem(){
            datos = null;
            id_item = -1;
            modificada = false;
        }

        function limpiarItemComparativo(){
            datos_comp = null;
            id_item_comp = -1;
        }

        return{
            setItem:setItem,
            getItem:getItem,
            setItemComp:setItemComp,
            getItemComp:getItemComp,
            setPrecioItem:setPrecioItem,
            getPrecioItem:getPrecioItem,
            setCostoItem:setCostoItem,
            getCostoItem:getCostoItem,
            getPlan:getPlan,
            setModificada:setModificada,
            getModificada:getModificada,
            setActividad:setActividad,
            getActividad:getActividad,
            getDatos:getDatos,
            setDatos:setDatos,
            getDatosComp:getDatosComp,
            setDatosComp:setDatosComp,
            getCeldaEditada:getCeldaEditada,
            setCeldaEditada:setCeldaEditada,
            limpiarItem:limpiarItem,
            limpiarItemComparativo:limpiarItemComparativo
        }
    }();

    // Evento que permite enviar una alerta al usuario cuando esta tratando de salir de la pagina y hay
    // cambios que no han sido guardados
    $(window).bind("beforeunload",function(event) {
        if(obj_trabajo.getModificada()) 
            return "Hay cambios que no han sido guardados, ¿está seguro de querer salir?";
    });

    // Mantener sincronizado el movimiento del scroll inferior con el superior
    $('#tab_item_planificacion_tv').on('scroll', function () {
        $('#tab_item_planificacion_tv_comp').scrollLeft($(this).scrollLeft());
    });

    // Mantener sincronizado el movimiento del scroll superior con el inferior
    $("#tab_item_planificacion_tv_comp").on("scroll", function () {
        $("#tab_item_planificacion_tv").scrollLeft($(this).scrollLeft());
    });

    // Primera actividad a la que se ingresa al trabajar una planificacion (proyectar ventas)
    $( "#enlace-proyeccion" ).addClass( "subopcion-seleccionada" );

    $( "#plan_trabajo_detail" ).addClass( "opcion-seleccionada" );

    /* Se esconden las opciones para configurar precio blanco y costo unitario ya que
    se deben presentar al momento de trabajar la planificacion y no la proyeccion */
    $( "#btnPB" ).hide().tooltip().click(ajustarPBCU);
    $( "#btnCU" ).hide().tooltip().click(ajustarPBCU);

    /*
    Actualiza el atributo actividad del objeto obj_trabajo. Con esto se especifica el tipo de actividad
    que el usuario se encuentra realizando:
        - 1 Proyeccion
        - 2 Planificacion TV
        - 3 Planificacion AS
        - 4 Resumen
    */
    $( ".enlace-actividades" ).click(function(){
        switch ($(this).attr('id')){
            case 'enlace-proyeccion':
                obj_trabajo.setActividad(1);
                $( ".enlace-actividades" ).removeClass( "subopcion-seleccionada" );
                $( "#enlace-proyeccion" ).addClass( "subopcion-seleccionada" );
                $( "#tab_item_proyeccion" ).show();
                $( "#tab_item_proyeccion_comp" ).show();
                $( "#tab_item_planificacion_tv" ).hide();
                $( "#tab_item_planificacion_tv_comp" ).hide();
                $( "#tab_item_planificacion_as" ).hide();
                $( "#tab_item_planificacion_as_comp" ).hide();
                $( "#tab_item_resumen" ).hide();
                $( "#tab_item_resumen_comp" ).hide();
                $( "#btnPB" ).hide();
                $( "#btnCU" ).hide();
                break;
            case 'enlace-planificacion-tv':
                obj_trabajo.setActividad(2);
                $( ".enlace-actividades" ).removeClass( "subopcion-seleccionada" );
                $( "#enlace-planificacion-tv" ).addClass( "subopcion-seleccionada" );
                $( "#tab_item_proyeccion" ).hide();
                $( "#tab_item_proyeccion_comp" ).hide();
                $( "#tab_item_planificacion_tv" ).show();
                $( "#tab_item_planificacion_tv_comp" ).show();
                $( "#tab_item_planificacion_as" ).hide();
                $( "#tab_item_planificacion_as_comp" ).hide();
                $( "#tab_item_resumen" ).hide();
                $( "#tab_item_resumen_comp" ).hide();
                if ( obj_trabajo.getItem() != -1 ){
                    $( "#btnPB" ).show();
                    $( "#btnCU" ).show();
                }                
                break;
            case 'enlace-planificacion-as':
                obj_trabajo.setActividad(3);
                $( ".enlace-actividades" ).removeClass( "subopcion-seleccionada" );
                $( "#enlace-planificacion-as" ).addClass( "subopcion-seleccionada" );
                $( "#tab_item_proyeccion" ).hide();
                $( "#tab_item_proyeccion_comp" ).hide();
                $( "#tab_item_planificacion_tv" ).hide();
                $( "#tab_item_planificacion_tv_comp" ).hide();
                $( "#tab_item_planificacion_as" ).show();
                $( "#tab_item_planificacion_as_comp" ).show();
                $( "#tab_item_resumen" ).hide();
                $( "#tab_item_resumen_comp" ).hide();
                $( "#btnPB" ).hide();
                $( "#btnCU" ).hide();
                break;
            case 'enlace-resumen':
                obj_trabajo.setActividad(4);
                $( ".enlace-actividades" ).removeClass( "subopcion-seleccionada" );
                $( "#enlace-resumen" ).addClass( "subopcion-seleccionada" );
                $( "#tab_item_proyeccion" ).hide();
                $( "#tab_item_proyeccion_comp" ).hide();
                $( "#tab_item_planificacion_tv" ).hide();
                $( "#tab_item_planificacion_tv_comp" ).hide();
                $( "#tab_item_planificacion_as" ).hide();
                $( "#tab_item_planificacion_as_comp" ).hide();
                $( "#tab_item_resumen" ).show();
                $( "#tab_item_resumen_comp" ).show();
                $( "#btnPB" ).hide();
                $( "#btnCU" ).hide();
                break;
            default:
                alert("No se ha escogido ninguna actividad!");
                obj_trabajo.setActividad(0);
                break;
        }
        if ( obj_trabajo.getItem() != -1 )
            $( "#combo_resultado" ).trigger( "change" );
        if ( obj_trabajo.getItemComp() != -1 )
            busquedaAJAXdatosComp(obj_trabajo.getItemComp());
    });

    /*
        Guarda la proyeccion sobre la cual se esta trabajando.
    */
    $("#btnSave").click(function(event){
        event.preventDefault();
        if ( verificarGuardar() ){
            var plan = obj_trabajo.getPlan();
            var itemplan = obj_trabajo.getItem();
            var ventas = obj_trabajo.getDatos();
            var url = null;
            
            json_data = JSON.stringify({
                'plan': plan, 
                'itemplan': itemplan,
                'ventas': ventas.ventas
            });

            /* Se determina el tipo de tarea que esta realizando el usuario para
            definir la url correspondiente a la vista que guardara los datos */
            switch(obj_trabajo.getActividad()){
                case 1:
                    url = '/planes/plan/guardar-proyeccion/';
                    break;
                case 2:
                    url = '/planes/plan/guardar-planificacion-tv/';
                    break;
                case 3:
                    url = '/planes/plan/guardar-planificacion-as/';
                    break;
                case 4:
                    url = null;
                    break;
                default:
                    url = null;
                    break;
            }
            
            $("#json_datos_tarea").val(json_data);

            if ( url != null ){
                $.ajax({
                    data: $("#form_datos").serialize(), // Se envia el form serializado para que contenga el token CSRF
                    url: url,
                    type: 'post',
                    
                }).done(saveAJAXDone);
            }
        }
    });

    /* Cada vez que un usuario hace click sobre un input, el contenido 
    aparece seleccionado */
    $('input[type=text]').click(function() {
        $(this).select();
    });

    /* Cada vez que se envia un AJAX request se despliega un imagen que 
    notifica al usuario que hay un proceso en desarrollo */
    $( document ).ajaxStart(function() {
        $("#dvLoading").show();
    });

    /* Cada vez que se recibe una respuesta a una solicitud AJAX se
    esconde la imagen desplegada en la funcion anterior */
    $( document ).ajaxStop(function() {
        $("#dvLoading").hide();
    });

    /* Para que al hacer click en la tecla ENTER, los formularios de
    los dialogs sean enviados */
    $('body').on('keypress', '.ui-dialog', function(event) { 
        if (event.keyCode === $.ui.keyCode.ENTER) { 
            $('.ui-dialog-buttonpane button:first', $(this)).click();
            return false;
        }
    }); 

    /* Para la activicion de tooltips */
    $( document ).tooltip({
        track: true
    });

    /* Permite abrir varios paneles del acordeon simultaneamente */
    $('#accordion').accordion({
        collapsible: true,
        heightStyle: "content",
        beforeActivate: function(event, ui) {
             // The accordion believes a panel is being opened
            if (ui.newHeader[0]) {
                var currHeader  = ui.newHeader;
                var currContent = currHeader.next('.ui-accordion-content');
             // The accordion believes a panel is being closed
            } else {
                var currHeader  = ui.oldHeader;
                var currContent = currHeader.next('.ui-accordion-content');
            }
             // Since we've changed the default behavior, this detects the actual status
            var isPanelSelected = currHeader.attr('aria-selected') == 'true';
            
             // Toggle the panel's header
            currHeader.toggleClass('ui-corner-all',isPanelSelected).toggleClass('accordion-header-active ui-state-active ui-corner-top',!isPanelSelected).attr('aria-selected',((!isPanelSelected).toString()));
            
            // Toggle the panel's icon
            currHeader.children('.ui-icon').toggleClass('ui-icon-triangle-1-e',isPanelSelected).toggleClass('ui-icon-triangle-1-s',!isPanelSelected);
            
             // Toggle the panel's content
            currContent.toggleClass('accordion-content-active',!isPanelSelected)    
            if (isPanelSelected) { currContent.slideUp(); }  else { currContent.slideDown(); }

            return false; // Cancels the default action
        }
    });
    
    $( "#dialog-box" ).dialog({
        autoOpen: false,
        width: 220,
        modal: true,
        buttons: {
            "Guardar": function() {
                /*
                parametros[0]: tipo de metrica (unidades, descuentos)
                parametros[1]: periodo
                parametros[2]: temporada
                */
                var parametros = [];
                var valor;
                var intRegex = /^\d+$/;
                var floatRegex = /^\-?([0-9]+(\.[0-9]+)?|Infinity)$/;
                var texto = "";
                parametros = obj_trabajo.getCeldaEditada().attr( "id" ).split("_");
                valor = $( "#inputval" ).val().replace('%','').replace(',','.');

                // Se revisa si el cambio corresponde a unidades o a un % de descuento
                if ( parametros[0] == "unidades" ) {
                    // Se valida que el valor ingresado sea un numero entero
                    if(intRegex.test(valor)) {
                       obj_trabajo.getCeldaEditada().text(valor);
                       switch(obj_trabajo.getActividad()){
                            case 1:
                                actualizarProyeccion(parametros[0], parametros[1], parametros[2]);
                                break;
                            case 2:
                                actualizarPeriodoPlanificacion(parametros[0], parametros[1], parametros[2]);
                                break;
                            case 3:
                                actualizarPlanificacionAS(parametros[0], parametros[1], parametros[2]);
                                break;
                            default:
                                return false;
                       }
                       $( "#inputval" ).val("");
                       if ( $( "#inputval" ).hasClass( "ui-state-error" ) )
                            $( "#inputval" ).removeClass( "ui-state-error" );
                        // Se marque que la proyeccion ha sido modificada y por lo tanto se desplegara
                        // una aleta si el usuario intenta salir de la pagina sin guardar los cambios
                        obj_trabajo.setModificada(true);
                        activarGuardar();
                       $( this ).dialog( "close" );
                    }
                    else {
                        $( "#inputval" ).addClass( "ui-state-error" );
                        texto = $( "#dialog_help_msg" ).text();
                        $( "#dialog_help_msg" ).html( "Sólo debe ingresar un número entero positivo." );
                        $( "#dialog_help_msg" ).addClass( "ui-state-highlight" );
                        setTimeout(function() {
                            $( "#dialog_help_msg" ).removeClass( "ui-state-highlight", 3000 );
                            $( "#dialog_help_msg" ).html(texto);
                        }, 3000 );
                    }
                }

                // Se trata de un ajuste de % de descuento
                else {
                    if(floatRegex.test(valor)) {
                        obj_trabajo.getCeldaEditada().text(valor + "%");
                        switch(obj_trabajo.getActividad()){
                            case 1:
                                actualizarProyeccion(parametros[0], parametros[1], parametros[2]);
                                break;
                            case 2:
                                actualizarPeriodoPlanificacion(parametros[0], parametros[1], parametros[2]);
                                break;
                            case 3:
                                actualizarPlanificacionAS(parametros[0], parametros[1], parametros[2]);
                                break;
                            default:
                                return false;
                        }
                        $( "#inputval" ).val("");
                        if ( $( "#inputval" ).hasClass( "ui-state-error" ) )
                        $( "#inputval" ).removeClass( "ui-state-error" );
                        // Se marque que la proyeccion ha sido modificada y por lo tanto se desplegara
                        // una aleta si el usuario intenta salir de la pagina sin guardar los cambios
                        obj_trabajo.setModificada(true);
                        activarGuardar();
                        $( this ).dialog( "close" );
                    }
                    else {
                        $( "#inputval" ).addClass( "ui-state-error" );
                        texto = $( "#dialog_help_msg" ).text();
                        $( "#dialog_help_msg" ).html( "Debe ingresar un número respetando el formato señalado." );
                        $( "#dialog_help_msg" ).addClass( "ui-state-highlight" );
                        setTimeout(function() {
                            $( "#dialog_help_msg" ).removeClass( "ui-state-highlight", 3000 );
                            $( "#dialog_help_msg" ).html(texto);
                        }, 3000 );
                    }
                }
            },
            Cancelar: function() {
                $( this ).dialog( "close" );
            }
        }
    });

    $( "#dialog-box-pbcu" ).dialog({
        autoOpen: false,
        width: 220,
        modal: true,
        buttons: {
            "Guardar": guardarPBCU,
            Cancelar: function() {
                $( this ).dialog( "close" );
            }
        }
    });

    $("#combo_resultado").change(busquedaAJAXdatos);
    $("[id^=button_cat_comp_]").click(function(){
        var id_item;
        var id_this = $(this).attr("id");
        // Se divide el ID del elemento BUTTON para generar el ID del elemento SELECT asociado
        // El cuarto valor del array es el ID asociado que se busca ya que el ID del elemento sigue la forma button_cat_comp_X
        id_button_array = id_this.split("_");
        id_item = $("#combo_cat_comp_" + id_button_array[3]).val();
        if ( id_item == -1 ){
            alert("Seleccione una opción válida.");
            return 0;
        }
        busquedaAJAXdatosComp(id_item);
    });
    $("[id^=combo_cat_proy_]").change(buscarCategoria);
    $("[id^=combo_cat_comp_]").change(buscarCategoriaComparacion);

});

</script>
<script src="{% static "planes/js/plan_trabajo_detail_general.js" %}" type="text/javascript"></script>
<script src="{% static "planes/js/plan_trabajo_detail_proyeccion.js" %}" type="text/javascript"></script>
<script src="{% static "planes/js/plan_trabajo_detail_planificacion_tv.js" %}" type="text/javascript"></script>
<script src="{% static "planes/js/plan_trabajo_detail_planificacion_as.js" %}" type="text/javascript"></script>
<script src="{% static "planes/js/plan_trabajo_detail_resumen.js" %}" type="text/javascript"></script>
<script src="{% static "js/rgraph/RGraph.common.core.js" %}"></script>
<script src="{% static "js/rgraph/RGraph.common.dynamic.js" %}"></script>   <!-- Just needed for dynamic features (eg tooltips) -->
<script src="{% static "js/rgraph/RGraph.common.annotate.js" %}"></script>  <!-- Just needed for annotating -->
<script src="{% static "js/rgraph/RGraph.common.context.js" %}"></script>   <!-- Just needed for context menus -->
<script src="{% static "js/rgraph/RGraph.common.tooltips.js" %}"></script>  <!-- Just needed for tooltips -->
<script src="{% static "js/rgraph/RGraph.drawing.rect.js" %}"></script>
<script src="{% static "js/rgraph/RGraph.bar.js" %}"></script>              <!-- Just needed for Bar charts -->
<script src="{% static "js/rgraph/RGraph.line.js" %}"></script>             <!-- Just needed for Line charts -->
{% endblock %}